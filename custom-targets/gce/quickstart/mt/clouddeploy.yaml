apiVersion: deploy.cloud.google.com/v1
kind: DeliveryPipeline
metadata:
  name: gce-pipeline-mt
serialPipeline:
  stages:
  - targetId: multi-target
    strategy:
      canary:
        customCanaryDeployment:
          phaseConfigs:
          - phaseId: "c50"
            percentage: 50
          - phaseId: "stable"
            percentage: 100
---
apiVersion: deploy.cloud.google.com/v1beta1
kind: Target
metadata:
  name: multi-target
description: parallel multi target Cloud Run Service
multiTarget:
  targetIds: [ gce1,gce2 ]
---
apiVersion: deploy.cloud.google.com/v1
kind: Target
metadata:
  name: gce1
customTarget:
  customTargetType: gce
deployParameters:
  customTarget/gceProject: chris-test1-475920
  customTarget/gceRegion: us-central1
  customTarget/gceInstanceGroupManagerPath: mig.yaml
  customTarget/gceBackendService: bs1
  customTarget/gceMigName: mig1
  customTarget/gceCloudLoadBalancerURLMap: projects/chris-test1-475920/regions/us-central1/urlMaps/l7-ilb-map
---
apiVersion: deploy.cloud.google.com/v1
kind: Target
metadata:
  name: gce2
customTarget:
  customTargetType: gce
deployParameters:
  customTarget/gceBackendServiceRegion: us-central1
  customTarget/gceProject: chris-test1-475920
  customTarget/gceRegion: us-central1
  customTarget/gceBackendService: bs2
  customTarget/gceMigName: mig2
  customTarget/gceBackendServiceProject: chris-test1-475920
  customTarget/gceInstanceGroupManagerPath: mig.yaml
  customTarget/gceBackendServiceTemplatePath: backend-service.yaml
  customTarget/gceCloudLoadBalancerURLMap: projects/chris-test1-475920/regions/us-central1/urlMaps/l7-ilb-map
